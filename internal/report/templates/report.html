<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>TrustWatch Compliance Report</title>
<style>
  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; padding: 24px; background: #fff; color: #1a1a1a; font-size: 14px; }
  h1 { font-size: 1.5em; margin: 0 0 4px 0; }
  h2 { font-size: 1.1em; margin: 24px 0 8px 0; border-bottom: 1px solid #ddd; padding-bottom: 4px; }
  .meta { color: #666; font-size: 0.85em; margin-bottom: 20px; }
  .meta span { margin-right: 24px; }
  .summary { display: flex; gap: 12px; margin-bottom: 20px; }
  .badge { display: inline-block; padding: 4px 12px; border-radius: 4px; font-weight: 600; font-size: 0.85em; }
  .badge-critical { background: #fee2e2; color: #991b1b; }
  .badge-warn { background: #fef3c7; color: #92400e; }
  .badge-info { background: #e0f2fe; color: #075985; }
  .badge-total { background: #f3f4f6; color: #374151; }
  table { border-collapse: collapse; width: 100%; font-size: 0.85em; margin-bottom: 24px; }
  th { text-align: left; padding: 8px 10px; border-bottom: 2px solid #d1d5db; color: #6b7280; font-weight: 600; background: #f9fafb; }
  td { padding: 6px 10px; border-bottom: 1px solid #e5e7eb; vertical-align: top; }
  tr.sev-critical td { color: #991b1b; }
  tr.sev-warn td { color: #92400e; }
  .detail { margin-bottom: 16px; padding: 12px; border: 1px solid #e5e7eb; border-radius: 4px; page-break-inside: avoid; }
  .detail-critical { border-left: 4px solid #dc2626; }
  .detail-warn { border-left: 4px solid #f59e0b; }
  .detail-info { border-left: 4px solid #3b82f6; }
  .detail h3 { margin: 0 0 8px 0; font-size: 0.95em; }
  .detail-grid { display: grid; grid-template-columns: 120px 1fr; gap: 2px 12px; font-size: 0.85em; }
  .detail-grid dt { color: #6b7280; font-weight: 600; }
  .detail-grid dd { margin: 0; word-break: break-all; }
  .empty { text-align: center; padding: 40px; color: #9ca3af; }
  .footer { margin-top: 32px; padding-top: 12px; border-top: 1px solid #e5e7eb; color: #9ca3af; font-size: 0.75em; }
  @media print {
    body { padding: 12px; }
    .detail { page-break-inside: avoid; }
  }
</style>
</head>
<body>
<h1>TrustWatch Compliance Report</h1>
<div class="meta">
  {{if .ClusterName}}<span>Cluster: <strong>{{.ClusterName}}</strong></span>{{end}}
  <span>Scanned: <strong>{{.ScanTime}}</strong></span>
</div>

<div class="summary">
  <span class="badge badge-critical">Critical: {{.CriticalCount}}</span>
  <span class="badge badge-warn">Warn: {{.WarnCount}}</span>
  <span class="badge badge-info">Info: {{.InfoCount}}</span>
  <span class="badge badge-total">Total: {{.TotalCount}}</span>
</div>

{{if .Findings}}
<h2>Findings Summary</h2>
<table>
<thead>
<tr><th>Severity</th><th>Source</th><th>Location</th><th>Expires In</th><th>Not After</th><th>Issue</th></tr>
</thead>
<tbody>
{{range .Findings}}
<tr class="sev-{{.Severity}}">
  <td>{{.SeverityLabel}}</td>
  <td>{{.Source}}</td>
  <td>{{.Where}}</td>
  <td>{{.ExpiresIn}}</td>
  <td>{{.NotAfter}}</td>
  <td>{{.Issue}}</td>
</tr>
{{end}}
</tbody>
</table>

<h2>Detailed Findings</h2>
{{range .Findings}}
<div class="detail detail-{{.Severity}}">
  <h3>{{.Where}} ({{.SeverityLabel}})</h3>
  <dl class="detail-grid">
    <dt>Source</dt><dd>{{.Source}}</dd>
    {{if .Subject}}<dt>Subject</dt><dd>{{.Subject}}</dd>{{end}}
    {{if .Issuer}}<dt>Issuer</dt><dd>{{.Issuer}}</dd>{{end}}
    {{if .Serial}}<dt>Serial</dt><dd>{{.Serial}}</dd>{{end}}
    {{if .DNSNames}}<dt>SANs</dt><dd>{{.DNSNames}}</dd>{{end}}
    {{if .NotAfter}}<dt>Expires</dt><dd>{{.NotAfter}} ({{.ExpiresIn}})</dd>{{end}}
    {{if .TLSVersion}}<dt>TLS</dt><dd>{{.TLSVersion}} / {{.CipherSuite}}</dd>{{end}}
    {{if .KeyAlgorithm}}<dt>Key</dt><dd>{{.KeyAlgorithm}}</dd>{{end}}
    {{if .ChainErrors}}<dt>Chain Errors</dt><dd>{{.ChainErrors}}</dd>{{end}}
    {{if .PostureIssues}}<dt>Posture</dt><dd>{{.PostureIssues}}</dd>{{end}}
    {{if .RevocationIssues}}<dt>Revocation</dt><dd>{{.RevocationIssues}}</dd>{{end}}
    {{if .FindingType}}<dt>Finding Type</dt><dd>{{.FindingType}}</dd>{{end}}
    {{if .Error}}<dt>Error</dt><dd>{{.Error}}</dd>{{end}}
    {{if .Remediation}}<dt>Remediation</dt><dd>{{.Remediation}}</dd>{{end}}
  </dl>
</div>
{{end}}
{{else}}
<p class="empty">No findings.</p>
{{end}}

<div class="footer">
  Generated by trustwatch
</div>
</body>
</html>
